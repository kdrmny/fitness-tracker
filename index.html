<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>LiftLog — Premium</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>tailwind.config={theme:{extend:{colors:{brand:{50:"#eef2ff",100:"#e0e7ff",500:"#6366f1",600:"#4f46e5",700:"#4338ca"}}}}}</script>
<script src="https://unpkg.com/feather-icons"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  .card{ @apply rounded-2xl border border-slate-200 dark:border-slate-700 bg-white/80 dark:bg-slate-800/70 backdrop-blur shadow-lg; }
  .btn{ @apply inline-flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition active:scale-95; }
  .btn-primary{ @apply bg-brand-600 hover:bg-brand-500 text-white; }
  .btn-ghost{ @apply bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600; }
  .fab{ @apply fixed bottom-24 right-5 z-40 rounded-full p-4 bg-brand-600 text-white shadow-2xl active:scale-95; }
  .tab{ @apply flex flex-col items-center justify-center text-[11px]; }
  .tab.active{ @apply text-brand-600 dark:text-brand-500; }
  .sheet{ @apply fixed inset-0 z-50 hidden; }
  .sheet.show{ display:block; }
  .sheet-backdrop{ @apply absolute inset-0 bg-black/40 backdrop-blur-sm; }
  .sheet-panel{ @apply absolute bottom-0 left-0 right-0 bg-white dark:bg-slate-900 rounded-t-2xl p-4 shadow-2xl; }
  .snackbar{ @apply fixed bottom-28 left-1/2 -translate-x-1/2 px-4 py-2 rounded-full bg-slate-900 text-white text-sm shadow-xl hidden; }
  .snackbar.show{ display:block; }
  .swipe{ touch-action: pan-y; }
  .kpi{ @apply card p-4; }
</style>
</head>
<body class="bg-slate-100 dark:bg-slate-900 text-slate-900 dark:text-slate-100">

<header class="sticky top-0 z-40 border-b border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-900/70 backdrop-blur">
  <div class="max-w-3xl mx-auto px-4 py-3 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="h-9 w-9 grid place-items-center rounded-xl bg-brand-600 text-white"><i data-feather="activity"></i></div>
      <div>
        <h1 class="text-lg font-bold leading-tight">LiftLog</h1>
        <p class="text-[11px] opacity-70 -mt-1">Premium Antrenman Asistanı</p>
      </div>
    </div>
    <button id="themeToggle" class="btn btn-ghost"><i data-feather="moon"></i></button>
  </div>
</header>

<main class="max-w-3xl mx-auto px-4 pb-28 pt-4">

  <!-- HOME -->
  <section id="screen-home" class="space-y-4">
    <div class="grid grid-cols-3 gap-3">
      <div class="kpi"><div class="text-xs opacity-70">Haftalık Set</div><div id="kpiSets" class="text-2xl font-bold">0</div></div>
      <div class="kpi"><div class="text-xs opacity-70">Son PR</div><div id="kpiPR" class="text-2xl font-bold">—</div></div>
      <div class="kpi"><div class="text-xs opacity-70">Toplam Hareket</div><div id="kpiMov" class="text-2xl font-bold">0</div></div>
    </div>
    <div class="card p-4">
      <h2 class="font-semibold mb-2">1RM İlerleme</h2>
      <canvas id="progressChart" height="180"></canvas>
    </div>
    <div class="card p-4">
      <h2 class="font-semibold mb-2">Son Antrenmanlar</h2>
      <ul id="lastWorkouts" class="space-y-2 text-sm"></ul>
    </div>
  </section>

  <!-- WORKOUT -->
  <section id="screen-workout" class="space-y-3 hidden">
    <div class="card p-4">
      <div class="flex items-center justify-between">
        <h2 class="font-semibold">Bugünkü Seans</h2>
        <span class="text-xs px-2 py-1 rounded-full bg-slate-100 dark:bg-slate-700" id="todayTag"></span>
      </div>
      <div id="rows" class="mt-3 space-y-2"></div>
      <div class="flex gap-2 mt-3">
        <button id="saveWorkout" class="btn btn-primary flex-1"><i data-feather="check-circle"></i> Kaydet</button>
        <button id="clearRows" class="btn btn-ghost flex-1"><i data-feather="trash-2"></i> Temizle</button>
      </div>
      <div class="mt-3 text-xs opacity-70">Öneri: PR’ın %65 / %75 / %85 bantlarını gösteriyoruz. Ağırlık girince bant ve uyarı netleşir.</div>
    </div>

    <div class="card p-4">
      <h2 class="font-semibold mb-2">Dinlenme Sayacı</h2>
      <div class="flex items-center gap-2">
        <input type="number" id="restMin" value="2" class="w-20 px-3 py-2 rounded-xl bg-slate-100 dark:bg-slate-700"> dk
        <button id="startTimer" class="btn btn-primary"><i data-feather="clock"></i> Başlat</button>
        <button id="stopTimer" class="btn btn-ghost"><i data-feather="square"></i> Dur</button>
        <div id="timer" class="ml-auto text-2xl font-bold">02:00</div>
      </div>
    </div>
  </section>

  <!-- PR MANAGER -->
  <section id="screen-pr" class="space-y-3 hidden">
    <div class="card p-4">
      <h2 class="font-semibold mb-2">PR Yöneticisi</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <select id="prSelect" class="px-3 py-3 rounded-xl bg-slate-100 dark:bg-slate-800"></select>
        <input id="prValue" type="number" class="px-3 py-3 rounded-xl bg-slate-100 dark:bg-slate-800" placeholder="PR (kg)">
      </div>
      <div class="flex gap-2 mt-2">
        <button id="prSave" class="btn btn-primary flex-1"><i data-feather="save"></i> Kaydet</button>
        <button id="prCalc" class="btn btn-ghost flex-1"><i data-feather="sliders"></i> Hesapla</button>
      </div>
      <div id="prResult" class="mt-3 text-sm"></div>
    </div>

    <div class="card p-4">
      <h2 class="font-semibold mb-2">Haftalık Artış Planı (8 Hafta)</h2>
      <div class="text-xs opacity-70 mb-2">Kural: üst gövde +2.5 kg/hafta, alt gövde +5 kg/hafta, makine ~%2.5/hafta. Başlangıç çalışma ağırlığı ≈ PR × 0.75 (2.5 kg’a yuvarlanır).</div>
      <ul id="progressPlan" class="space-y-2 text-sm"></ul>
    </div>
  </section>

  <!-- LIBRARY -->
  <section id="screen-library" class="space-y-3 hidden">
    <div class="flex items-center justify-between">
      <h2 class="font-semibold text-lg">Egzersiz Kütüphanesi</h2>
      <span class="text-xs px-2 py-1 rounded-full bg-slate-100 dark:bg-slate-700" id="libCount">0 hareket</span>
    </div>
    <div id="libList" class="space-y-2"></div>
  </section>

  <!-- SETTINGS -->
  <section id="screen-settings" class="space-y-3 hidden">
    <div class="card p-4">
      <h2 class="font-semibold mb-2">Veri</h2>
      <div class="flex gap-2">
        <button id="exportData" class="btn btn-ghost"><i data-feather="download-cloud"></i> JSON İndir</button>
        <button id="wipeData" class="btn btn-ghost"><i data-feather="trash"></i> Hepsini Sil</button>
      </div>
      <p class="text-xs opacity-70 mt-2">Veriler tarayıcınızda (localStorage) saklanır.</p>
    </div>
  </section>
</main>

<button id="fabAdd" class="fab"><i data-feather="plus"></i></button>

<!-- Bottom Tabs (5 sekme) -->
<nav class="fixed bottom-0 left-0 right-0 border-t border-slate-200 dark:border-slate-800 bg-white/90 dark:bg-slate-900/90 backdrop-blur">
  <div class="max-w-3xl mx-auto px-6 py-2 grid grid-cols-5 text-slate-500 dark:text-slate-400">
    <button class="tab active" data-go="home"><i data-feather="home"></i><span>Home</span></button>
    <button class="tab" data-go="workout"><i data-feather="activity"></i><span>Seans</span></button>
    <button class="tab" data-go="pr"><i data-feather="target"></i><span>PR</span></button>
    <button class="tab" data-go="library"><i data-feather="book-open"></i><span>Kütüphane</span></button>
    <button class="tab" data-go="settings"><i data-feather="settings"></i><span>Ayarlar</span></button>
  </div>
</nav>

<!-- Sheet -->
<div id="sheet" class="sheet">
  <div class="sheet-backdrop"></div>
  <div class="sheet-panel">
    <div class="h-1.5 w-10 bg-slate-300/70 rounded-full mx-auto mb-3"></div>
    <div class="flex items-center justify-between mb-2">
      <h3 id="sheetTitle" class="font-semibold">Egzersiz Ekle</h3>
      <button id="sheetClose" class="btn btn-ghost"><i data-feather="x"></i></button>
    </div>
    <div class="space-y-2">
      <input id="exName" class="w-full px-3 py-3 rounded-xl bg-slate-100 dark:bg-slate-800" placeholder="Egzersiz adı (örn. Bench Press)">
      <input id="exPR" type="number" class="w-full px-3 py-3 rounded-xl bg-slate-100 dark:bg-slate-800" placeholder="PR (kg)">
    </div>
    <div class="flex gap-2 mt-3">
      <button id="sheetSave" class="btn btn-primary flex-1"><i data-feather="check"></i> Kaydet</button>
      <button id="sheetDelete" class="btn btn-ghost flex-1 hidden text-red-600"><i data-feather="trash-2"></i> Sil</button>
    </div>
  </div>
</div>

<div id="snack" class="snackbar">Silindi. <button id="undo" class="underline ml-2">Geri al</button></div>

<script>
/* ===== Utilities & State (stabil) ===== */
const $=s=>document.querySelector(s), $$=s=>document.querySelectorAll(s);
const DBKEY='liftlog.v2';
const round25 = kg => Math.round(kg/2.5)*2.5;
const once = (fn) => { let done=false; return (...a)=>{ if(done) return; done=true; fn(...a); }; };
const debounce = (fn,ms=300)=>{ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms); }; };

const EX = (name,type) => ({name, type, pr:0});
const U='upper', L='lower', M='machine';

const defaults={lib:[
  // ——— 60 hareket ———
  EX('Back Squat',L),EX('Front Squat',L),EX('Deadlift',L),EX('Romanian Deadlift',L),
  EX('Leg Press',M),EX('Lunges',L),EX('Hip Thrust',L),EX('Bulgarian Split Squat',L),
  EX('Leg Extension',M),EX('Leg Curl',M),EX('Calf Raise',M),EX('Glute Bridge',L),
  EX('Bench Press',U),EX('Incline Bench Press',U),EX('Decline Bench Press',U),
  EX('Dumbbell Bench Press',U),EX('Incline DB Press',U),EX('Close-Grip Bench',U),
  EX('Overhead Press',U),EX('Push Press',U),EX('Arnold Press',U),EX('Lateral Raise',U),
  EX('Front Raise',U),EX('Rear Delt Fly',U),
  EX('Pull-Up',U),EX('Chin-Up',U),EX('Barbell Row',U),EX('Pendlay Row',U),
  EX('T-Bar Row',U),EX('Seated Row',M),EX('Lat Pulldown',M),
  EX('Cable Row',M),EX('Face Pull',M),
  EX('Biceps Curl (BB)',U),EX('Biceps Curl (DB)',U),EX('Hammer Curl',U),
  EX('Preacher Curl',M),EX('Cable Curl',M),
  EX('Triceps Pushdown',M),EX('Skull Crusher',U),EX('Overhead Triceps Ext',U),
  EX('Dips',U),EX('Machine Chest Press',M),EX('Pec Deck',M),
  EX('Cable Fly',M),EX('Chest Supported Row',U),
  EX('Good Morning',L),EX('Hack Squat',M),EX('Leg Adductor',M),EX('Leg Abductor',M),
  EX('Smith Squat',M),EX('Smith Bench',M),EX('Smith Row',M),
  EX('Farmer’s Walk',L),EX('Shrug',U),EX('Hyperextension',L),EX('Nordic Curl',L),
  EX('Sled Push',L),EX('Kettlebell Swing',L),EX('Hip Abduction Cable',M),EX('Single-Leg Press',M)
],history:[]};

/* veriyi yükle + göç */
function load(){
  try{
    let s=localStorage.getItem(DBKEY);
    if(!s){ localStorage.setItem(DBKEY,JSON.stringify(defaults)); return structuredClone(defaults); }
    let obj=JSON.parse(s);
    // v1→v2 basit göç: name/type eksikse düzelt
    if(!obj.lib) obj.lib=structuredClone(defaults.lib);
    obj.lib=obj.lib.map(e=>({name:e.name, type:e.type||U, pr:e.pr||0}));
    if(!obj.history) obj.history=[];
    return obj;
  }catch(e){ console.error(e); return structuredClone(defaults); }
}
let state=load();
const persist=debounce(()=>{ try{ localStorage.setItem(DBKEY,JSON.stringify(state)); }catch(e){ alert("Yerel kayıtta hata! Tarayıcı depolama dolu olabilir."); } },300);

/* artış kuralı */
function incFor(ex){
  if(ex.type===U) return {mode:'kg', step:2.5};
  if(ex.type===L) return {mode:'kg', step:5};
  return {mode:'pct', step:2.5}; // machine
}
function workSetFromPR(pr){ return round25(pr*0.75); }
function plan8Weeks(ex){
  const base = workSetFromPR(ex.pr||0);
  const {mode,step}=incFor(ex);
  const out=[];
  let w=base;
  for(let i=1;i<=8;i++){
    if(mode==='kg'){ w = round25(base + step*i); }
    else { w = round25(base * Math.pow(1+step/100,i)); }
    out.push({week:i, weight:w});
  }
  return {base, items:out};
}

/* Theme */
const themeToggle=$("#themeToggle"), root=document.documentElement;
const setTheme=dark=>{dark?root.classList.add('dark'):root.classList.remove('dark');localStorage.setItem('theme',dark?'dark':'light')};
setTheme(localStorage.getItem('theme')==='dark'); themeToggle.onclick=()=>setTheme(!root.classList.contains('dark'));

/* Tabs */
function show(screen){
  ["home","workout","pr","library","settings"].forEach(s=>{
    $("#screen-"+s).classList.toggle('hidden', s!==screen);
    $(`.tab[data-go="${s}"]`).classList.toggle('active', s===screen);
  });
}
$$('.tab').forEach(b=>b.onclick=()=>show(b.dataset.go));

/* KPIs & Chart */
let chart;
function oneRM(w,r){ return Math.round(w*(36/(37-r))); }
function updateKPIs(){
  $("#kpiMov").textContent=state.lib.length;
  const now=new Date(); const monday=new Date(now); monday.setDate(now.getDate()-((now.getDay()+6)%7));
  const weekSets=state.history.filter(h=>new Date(h.day)>=monday).reduce((a,h)=>a+(h.s||1),0);
  $("#kpiSets").textContent=weekSets;
  $("#kpiPR").textContent=Math.max(...state.lib.map(e=>e.pr||0))||'—';
  const ul=$("#lastWorkouts"); ul.innerHTML='';
  state.history.slice(-5).reverse().forEach(h=>{
    const li=document.createElement('li');
    li.className="flex items-center justify-between border-b border-slate-100 dark:border-slate-800 pb-1";
    li.innerHTML=`<div>${h.day} • <b>${h.name}</b> ${h.w}kg × ${h.r} × ${h.s}</div>`;
    ul.appendChild(li);
  });
  const data=state.history.slice(-60).map(h=>({x:h.day,y:oneRM(h.w,h.r)}));
  const ctx=$("#progressChart");
  if(chart) chart.destroy();
  chart=new Chart(ctx,{type:'line',data:{datasets:[{data,tension:.25}]},options:{plugins:{legend:{display:false}},scales:{x:{type:'time',time:{parser:'yyyy-MM-dd',unit:'day'}}}}});
}

/* Workout */
const rows=$("#rows"); $("#todayTag").textContent=new Date().toLocaleDateString('tr-TR',{weekday:'long',day:'2-digit',month:'short'});
function addRow(pref={}){
  const id='r'+Math.random().toString(36).slice(2,7);
  const row=document.createElement('div');
  row.className="card p-3";
  row.innerHTML=`
    <div class="flex items-center gap-2">
      <input class="flex-1 px-3 py-2 rounded-xl bg-slate-100 dark:bg-slate-800" id="${id}-n" placeholder="Egzersiz" value="${pref.name||''}">
      <input type="number" class="w-20 px-3 py-2 rounded-xl bg-slate-100 dark:bg-slate-800" id="${id}-w" placeholder="kg" value="${pref.w||''}">
      <input type="number" class="w-16 px-3 py-2 rounded-xl bg-slate-100 dark:bg-slate-800" id="${id}-r" placeholder="rep" value="${pref.r||''}">
      <input type="number" class="w-16 px-3 py-2 rounded-xl bg-slate-100 dark:bg-slate-800" id="${id}-s" placeholder="set" value="${pref.s||''}">
    </div>
    <div class="text-[11px] opacity-70 mt-1" id="${id}-tip">Öneri: —</div>`;
  rows.appendChild(row);
  const upd=()=>{
    const n=$("#"+id+"-n").value.trim(); const w=+($("#"+id+"-w").value||0);
    const ex=state.lib.find(e=>e.name.toLowerCase()===n.toLowerCase());
    const tip=$("#"+id+"-tip");
    if(!ex||!ex.pr){ tip.textContent="Öneri: PR gir → PR %65 / %75 / %85 bantları"; return; }
    const t65=round25(ex.pr*0.65), t75=round25(ex.pr*0.75), t85=round25(ex.pr*0.85);
    if(!w){ tip.textContent=`Öneri: ${t65} / ${t75} / ${t85} kg`; return; }
    const pct=Math.round((w/(ex.pr||1))*100);
    tip.textContent = pct<65?`Hafif (%${pct}) +${round25(t75-w)}kg öneri` : pct>90?`Ağır (%${pct}) -${round25(w-t85)}kg öneri` : `İyi aralık (%${pct})`;
  };
  row.addEventListener('input',upd); upd();
}
function clearRows(){ rows.innerHTML=''; for(let i=0;i<3;i++) addRow(); }
clearRows();
$("#saveWorkout").onclick=()=>{
  const day=new Date().toISOString().slice(0,10);
  [...rows.children].forEach(card=>{
    const n=card.querySelector('input[id$="-n"]').value.trim();
    const w=+card.querySelector('input[id$="-w"]').value||0;
    const r=+card.querySelector('input[id$="-r"]').value||0;
    const s=+card.querySelector('input[id$="-s"]').value||0;
    if(n&&w&&r&&s){
      state.history.push({day,name:n,w,r,s});
      const ex=state.lib.find(e=>e.name.toLowerCase()===n.toLowerCase());
      if(ex && w>ex.pr) ex.pr=w;
    }
  });
  persist(); updateKPIs(); alert("Seans kaydedildi."); clearRows();
};
$("#clearRows").onclick=clearRows;

/* Rest timer */
let timer=null,secs=120; const fmt=s=>`${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;
const tv=$("#timer"); const setSecs=s=>{secs=s; tv.textContent=fmt(secs);};
setSecs(120);
$("#startTimer").onclick=()=>{ setSecs((+$("#restMin").value||2)*60); clearInterval(timer); timer=setInterval(()=>{secs--; tv.textContent=fmt(secs); if(secs<=0){clearInterval(timer); alert("Set zamanı!");}},1000); };
$("#stopTimer").onclick=()=>clearInterval(timer);

/* Library + swipe/undo */
const libList=$("#libList"), libCount=$("#libCount"); let undoPayload=null; const snack=$("#snack"), undoBtn=$("#undo");
function showSnack(msg){ snack.firstChild.textContent=msg+" "; snack.classList.add('show'); setTimeout(()=>snack.classList.remove('show'),3000); }
undoBtn.onclick=()=>{ if(!undoPayload) return; state.lib.splice(undoPayload.index,0,undoPayload.item); persist(); renderLib(); undoPayload=null; snack.classList.remove('show'); };

function renderLib(){
  libList.innerHTML=''; libCount.textContent=state.lib.length+" hareket";
  state.lib.forEach((ex,idx)=>{
    const row=document.createElement('div');
    row.className="card p-3 swipe overflow-hidden";
    row.innerHTML=`
      <div class="flex items-center justify-between">
        <div>
          <div class="font-medium">${ex.name}</div>
          <div class="text-xs opacity-70">Tip: ${ex.type.toUpperCase()} • PR: ${ex.pr||0} kg</div>
        </div>
        <div class="flex items-center gap-2">
          <button data-edit="${idx}" class="btn btn-ghost text-xs"><i data-feather="edit-2"></i> Düzenle</button>
          <button data-del="${idx}" class="btn btn-ghost text-xs text-red-600"><i data-feather="trash-2"></i> Sil</button>
        </div>
      </div>`;
    // swipe-to-delete
    let startX=0,cur=0; const inner=row.firstElementChild;
    row.addEventListener('touchstart',e=>{startX=e.touches[0].clientX;});
    row.addEventListener('touchmove',e=>{cur=e.touches[0].clientX-startX; if(cur<0){ inner.style.transform=`translateX(${cur}px)`; inner.style.opacity=Math.max(0.3,1+cur/200);} });
    row.addEventListener('touchend',()=>{ if(cur<-100){ undoPayload={item:ex,index:idx}; state.lib.splice(idx,1); persist(); renderLib(); showSnack("Silindi."); } else { inner.style.transform=''; inner.style.opacity=''; } cur=0; });
    libList.appendChild(row);
  });
  feather.replace();
}
renderLib();

/* Add/Edit via Sheet */
const sheet=$("#sheet"), sheetTitle=$("#sheetTitle"), sheetSave=$("#sheetSave"), sheetDel=$("#sheetDelete");
const exName=$("#exName"), exPR=$("#exPR"); let editIndex=null;
function openSheet(mode, index=null){
  editIndex=index; sheetTitle.textContent = mode==="edit"?"Egzersizi Düzenle":"Egzersiz Ekle";
  sheetDel.classList.toggle('hidden', mode!=="edit");
  if(mode==="edit"){ const ex=state.lib[index]; exName.value=ex.name; exPR.value=ex.pr||0; } else { exName.value=""; exPR.value=""; }
  sheet.classList.add('show');
}
function closeSheet(){ sheet.classList.remove('show'); }
$("#fabAdd").onclick=()=>openSheet("add");
$("#sheetClose").onclick=closeSheet;
sheetSave.onclick=()=>{
  const n=exName.value.trim(); const pr=+exPR.value||0; if(!n) return alert("İsim gir.");
  if(editIndex!=null){ state.lib[editIndex]={...state.lib[editIndex], name:n, pr}; }
  else{ state.lib.push({name:n, type:U, pr}); }
  persist(); renderLib(); updateKPIs(); closeSheet();
};
sheetDel.onclick=()=>{
  if(editIndex==null) return; undoPayload={item:state.lib[editIndex], index:editIndex};
  state.lib.splice(editIndex,1); persist(); renderLib(); closeSheet(); showSnack("Silindi.");
};
libList.addEventListener('click',e=>{
  const btn=e.target.closest('button'); if(!btn) return;
  if(btn.dataset.edit) openSheet("edit", +btn.dataset.edit);
  if(btn.dataset.del){ undoPayload={item:state.lib[+btn.dataset.del], index:+btn.dataset.del}; state.lib.splice(+btn.dataset.del,1); persist(); renderLib(); showSnack("Silindi."); }
});

/* PR Manager */
const prSelect=$("#prSelect"), prValue=$("#prValue"), prResult=$("#prResult"), progressPlan=$("#progressPlan");
function fillSelect(){
  prSelect.innerHTML=state.lib.map((e,i)=>`<option value="${i}">${e.name}</option>`).join('');
}
fillSelect();

function renderPlan(){
  progressPlan.innerHTML='';
  state.lib.filter(e=>e.pr>0).slice(0,30).forEach(ex=>{
    const p=plan8Weeks(ex);
    const li=document.createElement('li');
    const inc=incFor(ex);
    li.className="card p-3";
    li.innerHTML=`
      <div class="font-medium mb-1">${ex.name} • Başlangıç: <b>${p.base} kg</b> • Artış: <b>${inc.mode==='kg'?('+'+inc.step+' kg'):('+%'+inc.step)}</b>/hafta</div>
      <div class="text-xs opacity-80"> ${p.items.map(it=>`Hafta ${it.week}: ${it.weight} kg`).join(' • ')} </div>`;
    progressPlan.appendChild(li);
  });
}

$("#prSave").onclick=()=>{
  const idx=+prSelect.value; const v=+prValue.value||0;
  state.lib[idx].pr=v; persist(); renderLib(); updateKPIs(); renderPlan();
  $("#prResult").innerHTML=`<div class="text-sm">PR kaydedildi: <b>${state.lib[idx].name}</b> = <b>${v} kg</b></div>`;
};
$("#prCalc").onclick=()=>{
  const idx=+prSelect.value; const v=+prValue.value||0; const ex=state.lib[idx]; if(!v){ prResult.textContent="PR gir."; return; }
  const w65=round25(v*0.65), w75=round25(v*0.75), w85=round25(v*0.85);
  const base=workSetFromPR(v); const inc=incFor(ex);
  const p=plan8Weeks({...ex,pr:v});
  prResult.innerHTML=`
    <div class="text-sm">Önerilen setler: <b>${w65}</b> / <b>${w75}</b> / <b>${w85}</b> kg</div>
    <div class="text-sm mt-1">Başlangıç çalışma: <b>${base} kg</b> • Artış: <b>${inc.mode==='kg'?('+'+inc.step+' kg'):('+%'+inc.step)}</b>/hafta</div>
    <div class="text-xs opacity-80 mt-1">${p.items.map(it=>`H${it.week}: ${it.weight}kg`).join(' • ')}</div>`;
};

/* Settings */
$("#exportData").onclick=()=>{
  const blob=new Blob([JSON.stringify(state,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob); const a=document.createElement('a');
  a.href=url; a.download='liftlog-export.json'; a.click(); URL.revokeObjectURL(url);
};
$("#wipeData").onclick=()=>{ if(confirm("Tüm veriler silinsin mi?")){ localStorage.removeItem(DBKEY); state=load(); renderLib(); updateKPIs(); clearRows(); fillSelect(); renderPlan(); } };

/* Init */
function boot(){
  show('home'); updateKPIs(); renderPlan(); feather.replace();
  $("#todayTag").textContent=new Date().toLocaleDateString('tr-TR',{weekday:'long',day:'2-digit',month:'short'});
}
boot();
</script>
</body>
</html>
